---
import { apiCalls, getLangPrefix } from "@lib/postmethodService";
import { EndPointPaths } from "@lib/EndPointPaths";
import { RequestModel } from "@lib/pojo/requestmodel/RequestModel";
import type { ApiResponse } from "@lib/pojo/responsemodel/ApiResponse";
import type { CatResponse } from "@lib/pojo/responsemodel/CatResponse";
import type { ResponseModel } from "@lib/pojo/responsemodel/ResponseModel";

interface Props {
  lang: string;
}

const { lang = "ar" } = Astro.props;
const langPrefix = getLangPrefix(lang);

const categoryCache = new Map<string, Array<CatResponse>>();
async function getCategory(lang: string) {
  const cacheKey = `${lang}_footer_cat`;
  if (categoryCache.has(cacheKey)) return categoryCache.get(cacheKey);

  const req = new RequestModel();
  req.lang = lang;

  const response: ApiResponse = await apiCalls(
    req,
    EndPointPaths.getallcategories,
  );
  if (response.status !== 0) return [];

  const list: ResponseModel = response.data;
  categoryCache.set(cacheKey, list.respList);
  return list.respList;
}
const categories: Array<CatResponse> = await getCategory(lang);
const isRTL = lang === "ar";
---
<div class="hero-snap">
 {categories.map((cat) => (
        <a href={`/category/${cat.slug}`} class="slide">
          {cat.title}
        </a>
      ))}
</div>


<style>
  .hero-snap {
  display: flex;
  overflow-x: auto;
  scroll-snap-type: x mandatory;
  gap: 12px;
  -webkit-overflow-scrolling: touch;
}

.slide {
  flex: 0 0 100%;
  scroll-snap-align: start;
  border-radius: 16px;
  overflow: hidden;
}
 
</style>
<script>
  import Swiper from 'swiper';
  import 'swiper/css';

  document.addEventListener('DOMContentLoaded', () => {
    new Swiper('.swiper', {
      slidesPerView: 1,
      pagination: { el: '.swiper-pagination' },
    });
  });
</script>