---
import LanguageSwitcher from "@components/LanguageSwitcher.astro";
import { getAppConfig } from "@lib/AppConfig";
import { Image } from "astro:assets";

const currentPath = Astro.url.pathname;
const apiServer=await getAppConfig();
const lang = currentPath.startsWith("/"+apiServer.secondaryLanguage) ? apiServer.secondaryLanguage : apiServer.defaultLanguage;
const isArabic = lang === "ar";
const navItems = [
  { labelAr: "الرئيسية", labelEn: "Home", href: "/" },
  { labelAr: "مقالات", labelEn: "Articles", href: "/article" },
  { labelAr: "مسابقة معرفية", labelEn: "Quiz", href: "/quiz" },
  { labelAr: "قصص الويب", labelEn: "Web Stories", href: "/stories" },
  { labelAr: "اتصل بنا", labelEn: "Contact", href: "/contact" },
  { labelAr: "من نحن", labelEn: "About", href: "/about" },
];
---

<style>
  /* ===============================
   THEME VARIABLES
================================ */
  :root {
    --bg-header: #b6babd;
    --bg-menu: #ffffff;
    --text-primary: #222;
    --border-color: #e5e5e5;
  }

  @media (prefers-color-scheme: dark) {
    :root {
      --bg-header: #b6babd;
      --bg-menu: #ffffff;
      --text-primary: #222;
      --border-color: #e5e5e5;
    }
  }

  /* ===============================
   HEADER
================================ */
  header {
    position: sticky;
    top: 0;
    inset-inline: 0; /* logical left + right */

    height: 64px;
    display: flex;
    align-items: center;
    justify-content: space-between;

    padding-inline: 16px;

    background: var(--bg-header);
    border-bottom: 1px solid var(--border-color);
    z-index: 1000;
  }

  header {
    padding-left: max(16px, env(safe-area-inset-left));
    padding-right: max(16px, env(safe-area-inset-right));
  }

  /* @media (max-width: 768px) {
    header {
      width: 100vw;
      max-width: 100vw;

      padding-left: calc(16px + env(safe-area-inset-left));
      padding-right: calc(16px + env(safe-area-inset-right));
    }
  } */
  /* ===============================
   LOGO
================================ */
  .logo {
    display: flex;
    align-items: center;
  }

  .header-logo {
    width: 40px;
    height: auto;
    display: block;
  }

  /* ===============================
   DESKTOP NAV
================================ */
  nav.desktop {
    display: flex;
    align-items: center;
    gap: 20px;
  }

  nav.desktop a {
    text-decoration: none;
    color: var(--text-primary);
    font-size: 15px;
  }

  /* ===============================
   HAMBURGER
================================ */
  .hamburger {
    display: none;
    font-size: 26px;
    padding: 10px;
    cursor: pointer;
    color: var(--text-primary);
  }

  /* ===============================
   MOBILE MENU
================================ */
  .mobile-menu {
    position: fixed;
    top: 0;
    bottom: 0;
    width: 260px;
    background: var(--bg-menu);
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 20px;
    z-index: 1100;
    transition: transform 0.3s ease;
    will-change: transform;
  }

  .mobile-menu a {
    font-size: 18px;
    text-decoration: none;
    color: var(--text-primary);
  }

  .close-btn {
    font-size: 30px;
    cursor: pointer;
    align-self: flex-end;
  }

  /* RTL / LTR SLIDE */
  .mobile-menu.ltr {
    right: 0;
    transform: translateX(100%);
  }

  .mobile-menu.rtl {
    left: 0;
    transform: translateX(-100%);
  }

  body.menu-open .mobile-menu {
    transform: translateX(0);
  }

  body.menu-open {
   overflow: hidden;
  }

  /* ===============================
   RESPONSIVE
================================ */
  @media (max-width: 768px) {
    nav.desktop {
      display: none;
    }

    .hamburger {
      display: block;
    }
  }
</style>

<header dir={isArabic ? "rtl" : "ltr"}>
  <!-- LOGO -->
  <div class="logo">
    <a href={isArabic ? "/" : "/en"}>
      <Image
        src="/headerlogo.webp"
        alt="Quronfula Logo"
        width={40}
        height={40}
        loading="eager"
        fetchpriority="high"
        class="header-logo"
      />
    </a>
  </div>

  <!-- DESKTOP NAV -->
  <nav class="desktop">
    {
      navItems.map((item) => (
        <a href={isArabic ? item.href : `/en${item.href}`}>
          {isArabic ? item.labelAr : item.labelEn}
        </a>
      ))
    }
    <LanguageSwitcher lang={lang} currentPath={currentPath} />
  </nav>

  <!-- HAMBURGER -->
  <div class="hamburger" aria-label="Menu">☰</div>
</header>

<!-- MOBILE MENU -->
<div class={`mobile-menu ${isArabic ? "rtl" : "ltr"}`}>
  <span class="close-btn" aria-label="Close Menu">×</span>

  {
    navItems.map((item) => (
      <a href={isArabic ? item.href : `/en${item.href}`}>
        {isArabic ? item.labelAr : item.labelEn}
      </a>
    ))
  }

  <LanguageSwitcher lang={lang} currentPath={currentPath} />
</div>
<script>
  const body = document.body;
  const hamburger = document.querySelector(".hamburger");
  const closeBtn = document.querySelector(".close-btn");
  const mobileLinks = document.querySelectorAll(".mobile-menu a");

  hamburger?.addEventListener("click", () => {
    body.classList.add("menu-open");
  });

  closeBtn?.addEventListener("click", () => {
    body.classList.remove("menu-open");
  });

  mobileLinks.forEach((link) => {
    link.addEventListener("click", () => {
      body.classList.remove("menu-open");
    });
  });

  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") {
      body.classList.remove("menu-open");
    }
  });
</script>
